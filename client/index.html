<div id = signDiv>
<p> Make sure to put in FAKE details only! This sight is not yet SSL secure</p>
	Username: <input id = "signDiv-username" type = "text"></input>
	Id: <input id = "signDiv-password" type = "text"></input>
	<button id = "signDiv-signIn">Sign In</button>
	<button id = "signDiv-signUp">Make Account</button>
	<!--Username: <input id = "signDiv-username" type = "text"></input>
	Password: <input id = "signDiv-password" type = "password"></input>
	<button id = "signDiv-signIn">Sign In</button>
	<button id = "signDiv-signUp">Sign Up</button> -->
</div>

<div id = "makeAccount" style = "display:none;"><!--
	Player Name: <input id = "newPlayername"></input> 
	<br> -->
	<canvas id="ctx2" width = "500" height = "500" style = "border:1px solid #000000;"></canvas>
</div>

<div id = "chooseUsername" style = "display:none;">
	<p>Enter a username. Inappropriate usernames will be banned.</p>
	<input id = "makeAccount-username" type = "text"></input>
	<button id = "makeAccount-check">Send</button>
	<p id = "resultMsg"></p>
	<button id = "backToLog" style = "display:none;">Back To Login</button>
	
</div> 

<!-- <div id = "menuUI" style = "display:none;background-color:black;position:absolute;top:20px;left:20px;width:680px;height:450px;z-index:2;">
	-->
<div id = "menuUI" style = "display:none;position:absolute;top:20px;left:20px;z-index:2;background-color:white;">
	<canvas id="ctx3" width = "580" height = "480" style = "border:1px solid #000000;"></canvas>
</div>

<div id="gameDiv" style = "display:none;">
	<canvas id="ctx" width = "1200" height = "500" style = "border:1px solid #000000;"></canvas>
	<div id = "chatbox" style = "position:absolute;top:20px;left:680px;z-index:1;padding-left:10px;padding-right:10px;background-color:rgb(240,240,240);padding-top:10px;">
		<div id="chat-text" style = "width:500px;height:100px;overflow-y:scroll;">
			<div> Hello!</div>
		</div>

		<form id = "chat-form">
			<input id = "chat-input" type="text" style = "width:500px"></input>
		</form>
	</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<!--
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
-->
<script> 


//$.getJSON('/client/npcText.json', function(data){
	//console.log(data);
//});

	var WIDTH = 1200;
	var HEIGHT = 500;
	var socket = io();

var UserCon = {};
UserCon.setAbil = {};

UserCon.menu = false;
UserCon.textBubble = false;

var Img = {};
Img.player = new Image();
Img.player.src = '/client/img/White Block.png';
Img.arrow = new Image();
Img.arrow.src = '/client/img/projectiles/Arrow.png';
Img.block = new Image();
Img.block.src = '/client/img/White Block.png';
Img.bow = {};
Img.bow[0] = new Image();
Img.bow[0].src = '/client/img/Avatar Sprites/Bow/Bow1.png';

Img.bow[1] = new Image();
Img.bow[1].src = '/client/img/Avatar Sprites/Bow/Bow2.png';

Img.bow[2] = new Image();
Img.bow[2].src = '/client/img/Avatar Sprites/Bow/Bow3.png';

Img.bow[3] = new Image();
Img.bow[3].src = '/client/img/Avatar Sprites/Bow/Bow4.png';

Img.bow[4] = new Image();
Img.bow[4].src = '/client/img/Avatar Sprites/Bow/Bow5.png';

Img.bow[5] = new Image();
Img.bow[5].src = '/client/img/Avatar Sprites/Bow/Bow6.png';

Img.bow[6] = new Image();
Img.bow[6].src = '/client/img/Avatar Sprites/Bow/Bow7.png';


Img.sword = {};
Img.sword[0] = new Image();
Img.sword[0].src = '/client/img/Avatar Sprites/Sword/Sword1.png';

Img.sword[1] = new Image();
Img.sword[1].src = '/client/img/Avatar Sprites/Sword/Sword2.png';

Img.sword[2] = new Image();
Img.sword[2].src = '/client/img/Avatar Sprites/Sword/Sword3.png';

Img.sword[3] = new Image();
Img.sword[3].src = '/client/img/Avatar Sprites/Sword/Sword4.png';

Img.sword[4] = new Image();
Img.sword[4].src = '/client/img/Avatar Sprites/Sword/Sword5.png';

Img.sword[5] = new Image();
Img.sword[5].src = '/client/img/Avatar Sprites/Sword/Sword6.png';

Img.sword[6] = new Image();
Img.sword[6].src = '/client/img/Avatar Sprites/Sword/Sword7.png';

Img.sword[7] = new Image();
Img.sword[7].src = '/client/img/Avatar Sprites/Sword/Sword8.png';


Img.explo = {};
Img.explo[0] = new Image();
Img.explo[0].src = '/client/img/Explosion/Explo1.png';

Img.explo[1] = new Image();
Img.explo[1].src = '/client/img/Explosion/Explo2.png';

Img.explo[2] = new Image();
Img.explo[2].src = '/client/img/Explosion/Explo3.png';

Img.explo[3] = new Image();
Img.explo[3].src = '/client/img/Explosion/Explo4.png';

Img.explo[4] = new Image();
Img.explo[4].src = '/client/img/Explosion/Explo5.png';

Img.explo[5] = new Image();
Img.explo[5].src = '/client/img/Explosion/Explo6.png';

Img.explo[6] = new Image();
Img.explo[6].src = '/client/img/Explosion/Explo7.png';

Img.explo[7] = new Image();
Img.explo[7].src = '/client/img/Explosion/Explo8.png';

Img.explo[8] = new Image();
Img.explo[8].src = '/client/img/Explosion/Explo8.png';

Img.str = new Image();
Img.str.src = '/client/img/White Block.png';
Img.vit = new Image();
Img.vit.src = '/client/img/White Block.png';
Img.def = new Image();
Img.def.src = '/client/img/White Block.png';
Img.mag = new Image();
Img.mag.src = '/client/img/White Block.png';


Img.fireball = new Image();
Img.fireball.src = '/client/img/Projectiles/Fireball.png';

Img.icons = {};
Img.icons[0] = new Image();
Img.icons[0].src = '/client/img/White Block.png';

Img.icons[1] = new Image();
Img.icons[1].src = '/client/img/White Block.png';

Img.icons[2] = new Image();
Img.icons[2].src = '/client/img/White Block.png';

Img.icons[3] = new Image();
Img.icons[3].src = '/client/img/White Block.png';
//UI Stuff Below!

Img.obs = {};

Img.obs[0] = new Image();
Img.obs[0].src = '/client/img/White Block.png';

Img.obs[1] = new Image();
Img.obs[1].src = '/client/img/Terrain/Town/Ground1.png';

Img.obs[2] = new Image();
Img.obs[2].src = '/client/img/Terrain/Town/Ground2.png';

Img.obs[3] = new Image();
Img.obs[3].src = '/client/img/Terrain/Town/Ground3.png';

var ctx3 = document.getElementById("ctx3").getContext("2d");

ctx3.font = '30px Arial';

drawMenu = function(){
	
	
	ctx3.drawImage(Img.block, 0, 400, 580, 80);
	
	ctx3.drawImage(Img.block, 3, 0, 190, 60);
	ctx3.drawImage(Img.block, 195, 0, 190, 60);
	ctx3.drawImage(Img.block, 387, 0, 190, 60);

	
	for(var i in UserCon.setAbil){
		if(UserCon.setAbil[i] != null){
			ctx3.drawImage(Img.icons[UserCon.setAbil[i]], 60 + (i * 100), 410, 60, 60);
		}
	}
	
	player = UserCon.character;
	
	console.log(player.levelPoints);
	if(UserCon.onEqip){
	
		ctx3.drawImage(Img.str, 50, 80, 60, 60);
		ctx3.drawImage(Img.vit, 50, 160, 60, 60);
		ctx3.drawImage(Img.mag, 50, 240, 60, 60);
		ctx3.drawImage(Img.def, 50, 320, 60, 60);
		
		ctx3.drawImage(Img.block, 130, 90, 40, 40);
		ctx3.drawImage(Img.block, 130, 170, 40, 40);
		ctx3.drawImage(Img.block, 130, 250, 40, 40);
		ctx3.drawImage(Img.block, 130, 330, 40, 40);
		
		
		ctx3.fillText(player.strength.toString(),50, 80, 60, 60);
		ctx3.fillText(player.vit.toString(),50, 160, 60, 60);
		ctx3.fillText(player.mag.toString(),50, 240, 60, 60);
		ctx3.fillText(player.def.toString(),50, 320, 60, 60);
		
	}
	if(UserCon.onAbil){
		var incr1 = 0;
		var incr2 = 0;
			
		for(var i in player.abil){
		
			if(player.abil[i] != null){
			
				ctx3.drawImage(Img.icons[i], 25 + (incr1 * 80), 85 + (incr2 * 80), 60, 60);
			
				incr1++;
			
				if(incr1 > 5){
					incr2++;
					incr1 = 0;
				}
			}			
		}

	}
	
}

changeSetAbil = function(abilNum, pos){
	console.log(abilNum);
	console.log(pos);
	socket.emit('changeSetAbil', {id:selfId, abilNum:abilNum, pos:pos});
}

drawIcon = function(imgIndex, x, y){
	
	ctx3.drawImage(Img.icons[imgIndex], x, y, 60, 60);
	
}
//Character Creation

var ctx2 = document.getElementById("ctx2").getContext("2d");
ctx2.font = '30px Arial';

creationPack = {};



var selectClass = function(){
	ctx2.fillStyle = 'black';
	ctx2.textAlign = "center";
	ctx2.fillText("Choose Your Class", 250 , 50); 
	ctx2.drawImage(Img.block, 75,100,150,150);
	ctx2.fillText("Warrior", 150 , 90); 
	ctx2.drawImage(Img.block, 275 ,100,150,150);
	ctx2.fillText("Ranger", 350 , 90); 
	ctx2.drawImage(Img.block, 75,300,150,150);
	ctx2.fillText("Mage", 150 , 290); 

	ctx2.drawImage(Img.block, 275,300,150,150);
	ctx2.fillText("None", 350, 290); 

	UserCon.classSelec = true;
}

var avatarMaker = function(clasChar){
	UserCon.classSelec = false;
	UserCon.makeAva = true;
	creationPack.clas = clasChar;
	ctx2.clearRect(0,0,500,500);
	creationPack.hat = 1;
	creationPack.body = 1;
	creationPack.weapon = 1;
	//drawAvatarPre(1,1,1);
	ctx2.fillText("Finish", 250, 390);
	ctx2.drawImage(Img.block, 100, 400, 300, 50);
}
var userSelec = function(){
	
	ctx2.clearRect(0, 0, 500, 500);
	
	UserCon.makeAva = false;
	UserCon.userSelec = true;
	
	makeAccount.style.display = 'none';
	chooseUsername.style.display = 'inline-block';
	
	
}

//Regular Gameplay Stuff Below

var ctx = document.getElementById("ctx").getContext("2d");
ctx.font = '30px Arial';
var textBox = document.getElementById('chatbox');

var Obstacle = function(initPack){
	var self = {};
	self.id = initPack.id;
	self.x = initPack.x;
	self.y = initPack.y;
	self.dx = initPack.dx;
	self.dy = initPack.dy;
	self.img = initPack.img;
	self.drawSeed = [];
	
	var incr3 = 0;
	
	while(incr3 <= 100){
		self.drawSeed[incr3] = Math.random();
		incr3++;
	}
	
	Obstacle.list[self.id] = self;
	self.draw = function(){
	if(self.img == 1){
	
		var x = self.x - Player.list[selfId].cx + WIDTH/2;
		var y = self.y - Player.list[selfId].cy + HEIGHT/2;
	
		incr1 = self.dx/32;
		console.log(incr1);
		ctx.drawImage(Img.obs[2], x, y + 32, self.dx, self.dy - 32);
		while(incr1 >= 1){
			ctx.drawImage(Img.obs[1], x + (32 * (self.dx/32 - incr1)), y, 32, 32);
			
							
			incr1--;
		}
		
		var wall1 = self.dx/32;
		var wall2 = self.dy/32;
		
		var incr2 = wall1/5;
		
		console.log(self.drawSeed);
		console.log(self.drawSeed[incr2]);
		
		while(incr2 >= 1){
			
			
			ctx.drawImage(Img.obs[3], x + (Math.floor(self.drawSeed[Math.floor(incr2)]*wall1) * 32), y + (Math.floor(self.drawSeed[Math.floor(101 - incr2)]*wall2) * 32 + 32), 32, 32);

			incr2--;

			
		}
	}
	else{
		var x = self.x - Player.list[selfId].cx + WIDTH/2;
		var y = self.y - Player.list[selfId].cy + HEIGHT/2;
	
	
	
		ctx.drawImage(Img.obs[self.img], x, y, self.dx, self.dy);
		}
	}
	
}


Obstacle.list = {};

var Background = function(initPack){

	var self = {};
	self.id = initPack.id;
	self.x = initPack.x;
	self.y = initPack.y;
	self.dx = initPack.dx;
	self.dy = initPack.dy;
	Background.list[self.id] = self;
	self.draw = function(){
	
		var x = self.x - Player.list[selfId].cx + WIDTH/2;
		var y = self.y - Player.list[selfId].cy + HEIGHT/2;
	
		ctx.drawImage(Img.block, x, y, self.dx, self.dy);
	}
}	

Background.list = {};


var changeAnimation = function(imgArray, imgIndex, indexMax){
	imgIndex++;
	if(imgIndex > indexMax){
	imgIndex = 0;
	}
	return {img: imgArray[imgIndex], index: imgIndex};
	
}

var threshCycle = function(value, valueSet, top, max){

		if(top == max && value >= valueSet[top]){
			return false;
		}
		
		if(top == max && value < valueSet[top]){
			return true;
		}
		
		
		if(value >= valueSet[top]){
		 
			return true;
		}
		else
			return false;
	
	
}

var Player = function(initPack){
	var self = {};
	self.id = initPack.id;
	self.number = initPack.number;
	self.x = initPack.x;
	self.y = initPack.y;
	self.hp = initPack.hp;
	self.hpMax = initPack.hpMax;
	self.score = initPack.score;
	self.name = initPack.name;
	self.dx = initPack.dx;
	self.dy = initPack.dy;
	self.cx = self.x + self.dx/2;
	self.cy = self.y + self.dy/2;
	self.clas = initPack.clas;
	
	self.bowCharge = initPack.bowCharge;
	self.bowImg = Img.bow[0];
	self.bowImgIndex = 0;
	
	self.meleeScore = 11;
	self.swordImg = Img.sword[0];
	self.swordImgIndex = 0;
		
	self.angle = initPack.angle;
	
	self.hat = initPack.hat;
	self.body = initPack.body;
	self.weapon = initPack.weapon;
	
	self.updateCenter = function(){
		self.cx = self.x + self.dx/2;
		self.cy = self.y + self.dy/2;
	}
	
	self.draw = function(){
	
	var width = Img.player.width*2;
	var height = Img.player.width*2;
	
	var x = self.x - Player.list[selfId].cx + self.dx/2 + WIDTH/2;
	var y = self.y - Player.list[selfId].cy + self.dy/2 + HEIGHT/2;
	
		ctx.drawImage(Img.player, x - 40, y - 40, 80, 20);
		ctx.drawImage(Img.player, x - 40, y - 20, 80, 60);
		
		if(self.clas == 'r'){
			
			if(threshCycle(self.bowCharge,[2,4,5,6,8,10,10],self.bowImgIndex, 6)){
				
				
				var bowAni = changeAnimation(Img.bow,self.bowImgIndex, 6)
				self.bowImg = bowAni.img;
				self.bowImgIndex = bowAni.index;
		
			}
		
			ctx.save();
			ctx.translate(x, y);
			ctx.rotate(self.angle*Math.PI/180);
			ctx.drawImage(self.bowImg, -(50), -(50), 100, 100);
			ctx.restore();

		}
		
		if(self.clas == 'w'){
			
	
			self.meleeScore++;
			if(threshCycle(self.meleeScore,[1,2,6,9,12,15,18,18],self.swordImgIndex, 7)){
				
				var swordAni = changeAnimation(Img.sword,self.swordImgIndex, 7)
				self.swordImg = swordAni.img;
				self.swordImgIndex = swordAni.index;
			
			}
			
			ctx.save();

			ctx.translate(x, y);
			ctx.rotate(self.angle*Math.PI/180);
			if(self.angle > 90 || self.angle < -90){
				ctx.scale(1,-1);
			}
			ctx.drawImage(self.swordImg, -(50), -(50), 100, 100);
			
			ctx.restore();
		}
		
	ctx.fillStyle = 'black';
	ctx.textAlign = "center";
	ctx.fillText(self.name, x, y - 63);
		
	var hpWidth = 60 * self.hp / self.hpMax;
	ctx.fillStyle = 'red';
	ctx.fillRect(x - hpWidth/2, y - 54, hpWidth,8);
		//ctx.fillText(self.score, self.x, self.y-60);
	}
	
	Player.list[self.id] = self;
	return self;
}
Player.list = {};

var Slime = function(initPack){
	var self = {};
	self.id = initPack.id;
	self.x = initPack.x;
	self.y = initPack.y;
	self.dx = initPack.dx;
	self.dy = initPack.dy;
	self.hp = initPack.hp;
	self.hpMax = initPack.hpMax;
	
	self.draw = function(){
	
		var x = self.x - Player.list[selfId].cx + WIDTH/2;
		var y = self.y - Player.list[selfId].cy + HEIGHT/2;
	
		ctx.drawImage(Img.block, x, y, 50, 50);
	//	console.log("slime made at: " + x + ", " + y);
	}
	
	Slime.list[self.id] = self;
	return self;
}
Slime.list = {};
	
var Bullet = function(initPack){
	var self = {};
	self.id = initPack.id;
	self.x = initPack.x;
	self.y = initPack.y;
	self.dx = initPack.dx;
	self.dy = initPack.dy; 
	self.img = initPack.img;
	self.angle = initPack.angle;
	self.type = initPack.type;
	
	self.explo = 0;
	self.exploIndex = -1;
	if(self.type == "arrow"){
		
		self.img = Img.arrow;
	
	}
	else if(self.type == "fireball"){
		
		self.img = Img.fireball;
	
	}
	else if(self.type == "windBlast"){
		self.img = Img.block;
	}
	
		
	self.draw = function(){
	
		var x = self.x - Player.list[selfId].cx + self.dx/2 + WIDTH/2;
		var y = self.y - Player.list[selfId].cy + self.dy/2 + HEIGHT/2;

		if(self.explo == 0){
			
			
		
			ctx.save();
			ctx.translate(x, y);
			ctx.rotate(self.angle*Math.PI/180);
			ctx.drawImage(self.img, -(self.dx/2), -(self.dy/2), self.dx, self.dy);
			ctx.restore();
		}
		else if(self.exploIndex <= 7){
			
					
			var exploAni = changeAnimation(Img.explo,self.exploIndex, 8);
			self.exploImg = exploAni.img;
			self.exploIndex = exploAni.index;
			
			//ctx.save();
			//ctx.translate(x, y);
			//ctx.rotate(self.angle*Math.PI/180);
			ctx.drawImage(self.exploImg, x - (self.exploImg.width/2), y - (self.exploImg.height/2), self.exploImg.width, self.exploImg.height);
			//ctx.restore();
		
		}
	}
	
	
	
	Bullet.list[self.id] = self;
	return self;
}
Bullet.list = {};
	var selfId = null;

	socket.on('init', function(data){
	
		if(data.whipe){
		
			Bullet.list = {};
			Obstacle.list = {};
			Player.list = {};
			Background.list = {};
			Slime.list = {};
			UserCon.textBubble = false;
			
		}
		if(data.level){
			if(data.selfData){
				UserCon.character = data.selfData;
				console.log(UserCon.character);
				}
			return;
		}
	//console.log(data);
		if(data.selfId)
			selfId = data.selfId;
		if(data.selfData){
			UserCon.character = data.selfData;
			console.log(UserCon.character);
		
			}

		for(var i = 0; i < data.player.length; i++){
			new Player(data.player[i]);
		}
		for(var i = 0; i < data.bullet.length; i++){
			new Bullet(data.bullet[i]);
		}
		for(var i = 0; i < data.slime.length; i++){
			new Slime(data.slime[i]);
		}
		for(var i in data.obstacle){
			new Obstacle(data.obstacle[i]);
		}
		for(var i in data.background){
			new Background(data.background[i]);
		}
		
	});
	
	socket.on('update', function(data){
	for(var i = 0; i < data.player.length; i++){
		var pack = data.player[i];
		var p = Player.list[pack.id];
		if(p){
			if(p.x !== undefined)
				p.x = pack.x;
			if(p.y !== undefined)
				p.y = pack.y;
			if(pack.hp !== undefined)
				p.hp = pack.hp;
			if(pack.score !== undefined)
				p.score = pack.score;
			if(pack.angle  !== undefined)
				p.angle = pack.angle;
			if(pack.bowCharge  !== undefined)
				p.bowCharge = pack.bowCharge;
			if(pack.meleeScore !== undefined && pack.meleeScore == true)
				p.meleeScore = 0;
			
			p.updateCenter();
		}
	}
	for(var i = 0; i < data.bullet.length; i++){
		var pack = data.bullet[i];
		var b = Bullet.list[data.bullet[i].id];
		if(b){
			if(b.x !== undefined)
				b.x = pack.x;
			if(b.y !== undefined)
				b.y = pack.y;
			if(b.explo !== undefined && pack.explo !== undefined)
				b.explo = pack.explo;
		}
	}
	for(var i = 0; i < data.slime.length; i++){
		var pack = data.slime[i];
		var s = Slime.list[data.slime[i].id];
		if(s){
			if(s.x !== undefined)
				s.x = pack.x;
			if(s.y !== undefined)
				s.y = pack.y;
		}
	}
	});
	
	socket.on('remove', function(data){
		for(var i = 0; i < data.player.length; i++){
			delete Player.list[data.player[i]];
		}
		for(var i = 0; i < data.bullet.length; i++){
			delete Bullet.list[data.bullet[i]];
		}
		for(var i = 0; i < data.slime.length; i++){
			delete Slime.list[data.slime[i]];
		}
	});
	
	socket.on('interactResponse', function(data){
		if(!data.success){
			
			toggleUI();
			UserCon.textBubble = false;				
			
		}
		else{
			if(UserCon.menu == true){
				toggleUI();
			}
		}
			
	});
	
	setInterval( function(){
		ctx.clearRect(0,0,WIDTH,HEIGHT);
		
		for(var i in Background.list){
			Background.list[i].draw();
		}
		for(var i in Player.list){
			Player.list[i].draw();
		
		}
		for(var i in Bullet.list){
			Bullet.list[i].draw();
	
		}
		
		for(var i in Obstacle.list){
			Obstacle.list[i].draw();
		}
		for(var i in Slime.list){
			Slime.list[i].draw();
		}

		if(document.activeElement.id != 'chat-input'){
			chatbox.style.opacity = 0.3;
		}
		else{
			chatbox.style.opacity = 1;
		}
		
		if(UserCon.menu){
			ctx3.clearRect(0,0,580,480);
			drawMenu();
			
			if(UserCon.dragIcon != null){
				drawIcon(UserCon.dragIcon, UserCon.mouseX - 42, UserCon.mouseY - 42);
			}
		}
		if(UserCon.textBubble != false){
			drawTextBubble(UserCon.textBubble);
		}
	}, 40);
	
	//var drawMap = function(){
	//if(selfId){
	//	var x = WIDTH/2 - Player.list[selfId].x;
	//	var y = HEIGHT/2 - Player.list[selfId].y;
   // }
	//	ctx.drawImage(Img.block,x-700,y,2000,600);
	
	//}
	
	//Documet Relation Stuff

	var signDiv = document.getElementById('signDiv');
	var signDivUsername = document.getElementById('signDiv-username');
	var signDivSignIn = document.getElementById('signDiv-signIn');
	var makeAccount = document.getElementById('makeAccount');
	var chooseUsername = document.getElementById('chooseUsername');
	var resultMsg = document.getElementById('resultMsg');
	var signDivSignUp = document.getElementById('signDiv-signUp');
	
	var usernameCheckInput = document.getElementById('makeAccount-username');
	var checkButton = document.getElementById('makeAccount-check');
	
	var signDivPassword = document.getElementById('signDiv-password');
	var backToLog = document.getElementById('backToLog');
	
	var menuUI = document.getElementById('menuUI');
	
	//signDivSignIn.onclick = function(){
		//socket.emit('signIn',{username:signDivUsername.value, password:signDivPassword.value});
	//}
	//signDivSignUp.onclick = function(){
		//socket.emit('signUp', {username:signDivUsername.value, password:signDivPassword.value});
	//}
	checkButton.onclick = function(){
		socket.emit('signUp', {username:usernameCheckInput.value, pack:creationPack});
	}
	signDivSignIn.onclick = function(){
		socket.emit('signIn', {username:signDivUsername.value, id:signDivPassword.value});
	}
	
	backToLog.onclick = function(){
		signDiv.style.display = 'inline-block';
		chooseUsername.style.display = 'none';
	}
	
	signDivSignUp.onclick = function(){
		signDiv.style.display = 'none';
		makeAccount.style.display = 'inline-block';
		selectClass();
	}
	
	socket.on('signInResponse', function(data){
		if(data.success){
			signDiv.style.display = 'none';
			gameDiv.style.display = 'inline-block';
			UserCon.inGame = true;
		}
		else
		alert("Sign in unsuccessful.");
	});
		
	socket.on('signUpResponse', function(data){
		if(data.success){
			checkButton.style.display = 'none';
			resultMsg.innerHTML = "Account created! Your ID is: " + data.id + ". Save this ID, you will use it to log in.";
			backToLog.style.display = 'inline-block';

			
		}
		else
			resultMsg.innerHTML = "Username taken, select another username.";
	});


var chatText = document.getElementById('chat-text');
var chatInput = document.getElementById('chat-input');
var chatForm = document.getElementById('chat-form');


socket.on('textBubble',function(data){
	UserCon.textBubble = data;
	
});

drawTextBubble = function(data){
	
	var x = data.x - Player.list[selfId].cx + WIDTH/2;
	var y = data.y - Player.list[selfId].cy + HEIGHT/2;

	ctx.strokeRect(x - 126, y - 30, 300, 80);
	
	var bubTxt = data.text.split('\br');
	
	for(var i in bubTxt){
	
		ctx.fillText(bubTxt[i], x + 2, y + i*12 + 2); 
	
	}
}

socket.on('addToChat', function(data){
	chatText.innerHTML += '<div>' + data + '</div>';
});
socket.on('evalAnswer',function(data){
	
});
socket.on('initial', function(data){
	P1.id = data.id;
	console.log(data.id);
}
);

chatForm.onsubmit = function(e){
	e.preventDefault();

	if(chatInput.value[0] === '/')
		socket.emit('evalServer', chatInput.value.slice(1));
	else
		socket.emit('sendMsgToServer', chatInput.value);
	chatInput.value = '';
}

var isMouseOn = function(mX, mY, mWidth, mHeight){
	if(UserCon.mouseX >= mX && UserCon.mouseX <= mX + mWidth && UserCon.mouseY >= mY && UserCon.mouseY <= mY + mHeight){
		return true;
	}
	else
		return false;
}

document.onkeydown = function(event){
//console.log(document.activeElement.id);
	if(document.activeElement.id != 'chat-input'){
		if(event.keyCode == 68)
			socket.emit('keyPress', {inputId:'right', state:true});
		else if(event.keyCode == 83)
			socket.emit('keyPress', {inputId:'down', state:true});
		else if(event.keyCode == 65)
			socket.emit('keyPress', {inputId:'left', state:true});
		else if(event.keyCode == 87)
			socket.emit('keyPress', {inputId:'up', state:true});
		
		
		if(event.keyCode == 69){
			socket.emit('keyPress', {inputId:'e', state:true});				
			socket.emit('checkInteract',{id:selfId});	
			

		}
		
		else if(event.keyCode == 49)
			socket.emit('keyPress', {inputId:'1', state:true});				
		else if(event.keyCode == 50)
			socket.emit('keyPress', {inputId:'2', state:true});				
		else if(event.keyCode == 51)
			socket.emit('keyPress', {inputId:'3', state:true});				
		else if(event.keyCode == 52)
			socket.emit('keyPress', {inputId:'4', state:true});
		else if(event.keyCode == 53)
			socket.emit('keyPress', {inputId:'5', state:true});		
		
	}
}
	
	document.onkeyup = function(event){
		
			if(event.keyCode == 68)
				socket.emit('keyPress', {inputId:'right', state:false});
			else if(event.keyCode == 83)
				socket.emit('keyPress', {inputId:'down', state:false});
			else if(event.keyCode == 65)
				socket.emit('keyPress', {inputId:'left', state:false});
			else if(event.keyCode == 87)
				socket.emit('keyPress', {inputId:'up', state:false});
			else if(event.keyCode == 69)
				socket.emit('keyPress', {inputId:'e', state:false});				
			else if(event.keyCode == 49)
				socket.emit('keyPress', {inputId:'1', state:false});				
			else if(event.keyCode == 50)
				socket.emit('keyPress', {inputId:'2', state:false});				
			else if(event.keyCode == 51)
				socket.emit('keyPress', {inputId:'3', state:false});				
			else if(event.keyCode == 52)
				socket.emit('keyPress', {inputId:'4', state:false});
			else if(event.keyCode == 53)
				socket.emit('keyPress', {inputId:'5', state:false});				
			

			
	}
	document.onmousedown = function(event){
		socket.emit('keyPress',{inputId: 'attack', state:true});
		if(UserCon.classSelec == true){
		
			if(isMouseOn(75,100,150,150))
				avatarMaker('w');
			if(isMouseOn(275,100,150,150))
				avatarMaker('r');
			if(isMouseOn(75,300,150,150))
				avatarMaker('m');
			if(isMouseOn(275,300,150,150))
				avatarMaker('c');
		}
		
		if(UserCon.makeAva == true){

			if(isMouseOn(100, 400, 300, 50)){
				userSelec();
			
			}
		}
		
		
		if(UserCon.menu){
			if(isMouseOn(3+12, 0+12, 190, 60)){
				UserCon.onAbil = true;
				UserCon.onInv = false;
				UserCon.onEqip = false;
			}
			if(isMouseOn(195+12, 0+12, 190, 60)){
				UserCon.onAbil = false;
				UserCon.onInv = true;
				UserCon.onEqip = false;
			}
			if(isMouseOn(387+12, 0+12, 190, 60)){
				UserCon.onAbil = false;
				UserCon.onInv = false;
				UserCon.onEqip = true;
			}
			
		}
		
		if(UserCon.menu && UserCon.onEqip){
		
			if(UserCon.character.levelPoints > 0){
				if(isMouseOn(130 + 12, 90 + 12, 40, 40)){
					socket.emit('statPlus', {id:selfId, stat: "str"});
					UserCon.character.strength++;
					UserCon.character.levelPoints--;
				}
				if(isMouseOn(130 + 12, 170 + 12, 40, 40)){
					socket.emit('statPlus', {id:selfId, stat: "vit"});		
					UserCon.character.vit++;
					UserCon.character.levelPoints--;
				}
				if(isMouseOn(130 + 12, 250 + 12, 40, 40)){
					socket.emit('statPlus', {id:selfId, stat: "mag"});			
					UserCon.character.mag++;
					UserCon.character.levelPoints--;
				}
				if(isMouseOn(130 + 12, 330 + 12, 40, 40)){
					socket.emit('statPlus', {id:selfId, stat: "def"});
					UserCon.character.def++;
				UserCon.character.levelPoints--;
				}
			}
		}
		

		if(UserCon.menu && UserCon.onAbil){
		
			var incr1 = 0;
			var incr2 = 0;
		
				for(var i in player.abil){
			
					if(player.abil[i] != null){
			
						if(isMouseOn(25 + (incr1 * 80) + 12, 85 + (incr2 * 80) + 12, 60, 60)){
							UserCon.dragIcon = i;
						}
						
					incr1++;
				
					if(incr1 > 5){
						incr2++;
						incr1 = 0;
					}
				}				
			}
			
		}
	}
	document.onmouseup = function(event){
	
		socket.emit('keyPress', {inputId:'attack', state:false});
		
		
		if(UserCon.dragIcon != null){

			for(i = 0; i < 6; i++){
				if(isMouseOn(60 + (100 * i), 410, 60, 60)){
					UserCon.setAbil[i] = UserCon.dragIcon;
					console.log("Placed in pos " + i);
					changeSetAbil(UserCon.dragIcon, i);
				}
			}
			UserCon.dragIcon = null;
		}
	}
	document.onmousemove = function(event){
		mouseMoved(event);
	}
	var mouseMoved = function(event){

		var x = -WIDTH/2 + event.clientX - 8;
		var y = -HEIGHT/2 + event.clientY - 8;
		var angle = Math.atan2(y,x) / Math.PI*180;
		socket.emit('keyPress', {inputId:'mouseAngle', state:angle});
		UserCon.mouseX = event.clientX - 8;
		UserCon.mouseY = event.clientY - 8;
	}
	var toggleUI = function(){
			
		if(UserCon.inGame){
		
			if(!UserCon.menu){
				menuUI.style.display = 'inline-block';
				UserCon.menu = true;
				UserCon.onAbil = true;
			}
			else{
				menuUI.style.display = 'none';
				UserCon.menu = false;
			}
		}
	}
</script>
